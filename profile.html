<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile | PortfolioX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="profile.css">
</head>
<body>

<header class="navbar">
  <div class="logo">Portfolio<span>X</span></div>
  <button class="logout-btn">Logout</button>
</header>

<div class="layout">

  <!-- Sidebar -->
  <aside class="sidebar">
    <a href="dashboard.html">Dashboard</a>
    <a href="profile.html" class="active">Profile</a>
    <a href="skills.html">Skills</a>
    <a href="education.html">Education</a>
    <a href="project.html">Projects</a>
    <a href="templates.html">Templates</a>
    <a href="preview.html">Preview</a>
    <a href="publish.html">Publish</a>
    <a href="settings.html">Settings</a>
  </aside>

  <!-- Profile Content -->
  <main class="profile">

    <!-- Header -->
    <section class="profile-header">
      <div class="avatar" id="avatar">U</div>
      <div>
        <h1>Your Profile</h1>
        <p>Update your personal information</p>
      </div>
    </section>

    <!-- Form -->
    <form class="profile-form" id="profileForm">

      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="fullName" placeholder="Enter your full name">
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" id="email" disabled>
      </div>

      <div class="form-group">
        <label>Phone</label>
        <input type="text" id="phone" placeholder="Enter phone number">
      </div>

      <div class="form-group full">
        <label>About You</label>
        <textarea id="about" placeholder="Write a short bio"></textarea>
      </div>

      <div class="form-group">
        <label>Location</label>
        <input type="text" id="location" placeholder="City, Country">
      </div>

      <div class="form-group">
        <label>Role / Title</label>
        <input type="text" id="role" placeholder="Web Developer, Designer, etc.">
      </div>

      <div class="form-group">
        <label>GitHub</label>
        <input type="text" id="github" placeholder="GitHub profile link">
      </div>

      <div class="form-group">
        <label>LinkedIn</label>
        <input type="text" id="linkedin" placeholder="LinkedIn profile link">
      </div>

      <div class="form-actions">
        <button type="submit">Save Profile</button>
      </div>

    </form>

  </main>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getAuth, 
    onAuthStateChanged, 
    signOut 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { 
    getFirestore, 
    doc, 
    setDoc, 
    getDoc 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  /* ðŸ”¥ Firebase Config */
  const firebaseConfig = {
    apiKey: "AIzaSyD4q_KzBCxVtS6mjH6Xh6-Bd1u-21RSNG4",
    authDomain: "portfoliox-2e787.firebaseapp.com",
    projectId: "portfoliox-2e787",
    storageBucket: "portfoliox-2e787.firebasestorage.app",
    messagingSenderId: "562709786891",
    appId: "1:562709786891:web:2d0f575ab7d3bda5fdf20e"
  };

  /* ðŸš€ Init Firebase */
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  /* ðŸ”— Elements */
  const form = document.getElementById("profileForm");
  const avatar = document.getElementById("avatar");
  const logoutBtn = document.querySelector(".logout-btn");

  /* ðŸ” AUTH GUARD + LOAD PROFILE */
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "loginpage.html";
      return;
    }

    // Set email
    document.getElementById("email").value = user.email;

    // Avatar first letter
    avatar.innerText = user.email.charAt(0).toUpperCase();

    // Load profile data
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
      const data = snap.data();

      document.getElementById("fullName").value = data.fullName || "";
      document.getElementById("phone").value = data.phone || "";
      document.getElementById("about").value = data.about || "";
      document.getElementById("location").value = data.location || "";
      document.getElementById("role").value = data.role || "";
      document.getElementById("github").value = data.github || "";
      document.getElementById("linkedin").value = data.linkedin || "";
    }
  });

  /* ðŸ’¾ SAVE PROFILE */
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const user = auth.currentUser;
    if (!user) return;

    const profileData = {
      fullName: document.getElementById("fullName").value,
      email: user.email,
      phone: document.getElementById("phone").value,
      about: document.getElementById("about").value,
      location: document.getElementById("location").value,
      role: document.getElementById("role").value,
      github: document.getElementById("github").value,
      linkedin: document.getElementById("linkedin").value,
      updatedAt: new Date()
    };

    await setDoc(doc(db, "users", user.uid), profileData);

    alert("Profile saved successfully âœ…");
  });

  /* ðŸšª LOGOUT */
  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    localStorage.clear();
    window.location.href = "loginpage.html";
  });
</script>

</body>
</html>
