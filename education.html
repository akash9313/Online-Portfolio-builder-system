<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Education | PortfolioX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="education.css">
</head>
<body>

<header class="navbar">
  <div class="logo">Portfolio<span>X</span></div>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</header>

<div class="layout">

  <aside class="sidebar">
    <a href="dashboard.html">Dashboard</a>
    <a href="profile.html">Profile</a>
    <a href="skills.html">Skills</a>
    <a class="active" href="education.html">Education</a>
    <a href="projects.html">Projects</a>
    <a href="templates.html">Templates</a>
    <a href="preview.html">Preview</a>
    <a href="publish.html">Publish</a>
    <a href="settings.html">Settings</a>
  </aside>

  <main class="education">

    <section class="education-header">
      <h1>Education</h1>
      <p>Add and manage your academic qualifications</p>
    </section>

    <!-- ADD EDUCATION -->
    <section class="add-education">
      <h2>Add Education</h2>

      <div class="education-form">
        <input id="degree" list="degreeList" placeholder="Degree (e.g. B.Tech in CSE)">
        <datalist id="degreeList">
          <option value="B.Tech in Computer Science">
          <option value="BCA">
          <option value="MCA">
          <option value="MBA">
          <option value="Higher Secondary (12th)">
          <option value="Secondary (10th)">
        </datalist>

        <input id="institute" list="instituteList" placeholder="Institution / University">
        <datalist id="instituteList">
          <option value="IIT Bombay">
          <option value="NIT Trichy">
          <option value="IIIT Vadodara">
          <option value="Gujarat University">
        </datalist>

        <input id="year" list="yearList" placeholder="Year (e.g. 2022 - 2026)">
        <datalist id="yearList">
          <option value="2019 - 2023">
          <option value="2020 - 2024">
          <option value="2021 - 2025">
          <option value="2022 - 2026">
        </datalist>

        <input id="grade" placeholder="Grade / CGPA (optional)">

        <button type="button" id="addEducationBtn">Add Education</button>
      </div>
    </section>

    <!-- LIST -->
    <section class="education-list">
      <h2>Your Education</h2>
      <div id="educationContainer"></div>
    </section>

  </main>
</div>

<!-- üî• FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD4q_KzBCxVtS6mjH6Xh6-Bd1u-21RSNG4",
  authDomain: "portfoliox-2e787.firebaseapp.com",
  projectId: "portfoliox-2e787",
  storageBucket: "portfoliox-2e787.firebasestorage.app",
  messagingSenderId: "562709786891",
  appId: "1:562709786891:web:2d0f575ab7d3bda5fdf20e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const degree = document.getElementById("degree");
const institute = document.getElementById("institute");
const year = document.getElementById("year");
const grade = document.getElementById("grade");
const addBtn = document.getElementById("addEducationBtn");
const container = document.getElementById("educationContainer");
const logoutBtn = document.getElementById("logoutBtn");

let currentUser = null;

/* üîê AUTH */
onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "loginpage.html";
    return;
  }
  currentUser = user;
  loadEducation();
});

/* ‚ûï ADD EDUCATION (FIXED) */
addBtn.addEventListener("click", async () => {
  if (!degree.value || !institute.value || !year.value) {
    alert("Please fill Degree, Institute and Year");
    return;
  }

  await addDoc(
    collection(db, "users", currentUser.uid, "education"),
    {
      degree: degree.value,
      institute: institute.value,
      year: year.value,
      grade: grade.value || "",
      createdAt: new Date()
    }
  );

  degree.value = "";
  institute.value = "";
  year.value = "";
  grade.value = "";

  loadEducation();
});

/* üì• LOAD EDUCATION */
async function loadEducation() {
  container.innerHTML = "";
  const snap = await getDocs(
    collection(db, "users", currentUser.uid, "education")
  );

  snap.forEach(d => {
    const e = d.data();
    const div = document.createElement("div");
    div.className = "education-card";
    div.innerHTML = `
      <h3>${e.degree}</h3>
      <p>${e.institute}</p>
      <span class="edu-meta">${e.year}${e.grade ? " ‚Ä¢ " + e.grade : ""}</span>
      <button class="delete-btn" data-id="${d.id}">üóëÔ∏è</button>
    `;
    container.appendChild(div);
  });

  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.onclick = async () => {
      await deleteDoc(
        doc(db, "users", currentUser.uid, "education", btn.dataset.id)
      );
      loadEducation();
    };
  });
}

/* üö™ LOGOUT */
logoutBtn.onclick = async () => {
  await signOut(auth);
  localStorage.clear();
  window.location.href = "homepage.html";
};
</script>

</body>
</html>
