<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | PortfolioX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="loginpage.css">
</head>
<body>

<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<div class="login-box">
  <h2>Login to <span>PortfolioX</span></h2>

  <!-- Email verification notice -->
  <div id="verifyInfo" style="
    display:none;
    margin-bottom:14px;
    padding:10px;
    border-radius:10px;
    background: rgba(255,193,7,0.15);
    color:#facc15;
    font-size:13px;
    text-align:center;
  ">
    üìß Your email is not verified.<br>
    Please check <b>Inbox / Spam / Promotions</b>.
  </div>

  <form id="loginForm">

    <div class="field">
      <input type="email" id="email" required>
      <label>Email</label>
    </div>

    <div class="field" style="position:relative;">
      <input type="password" id="password" required>
      <label>Password</label>
      <span id="toggleLoginPassword" style="
        position:absolute;
        right:14px;
        top:50%;
        transform:translateY(-50%);
        cursor:pointer;
      ">üëÅÔ∏è</span>
    </div>

    <button class="primary glow" type="submit">Login</button>

    <p style="text-align:center; margin-top:10px;">
      <a href="#" id="forgotPassword" style="color:#38bdf8;text-decoration:none;">
        Forgot password?
      </a>
    </p>

    <div style="margin:15px 0; text-align:center;">OR</div>

    <button type="button" id="googleLogin" class="primary glow">
      Continue with Google
    </button>

    <p class="signup-text">
      Don‚Äôt have an account?
      <a href="usersignup.html">Signup</a>
    </p>
  </form>
</div>

<!-- ================= FIREBASE AUTH ================= -->
<script type="module">
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import {
  getAuth,
  setPersistence,
  browserLocalPersistence,
  signInWithEmailAndPassword,
  GoogleAuthProvider,
  signInWithPopup,
  sendPasswordResetEmail,
  onAuthStateChanged
} from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyD4q_KzBCxVtS6mjH6Xh6-Bd1u-21RSNG4",
  authDomain: "portfoliox-2e787.firebaseapp.com",
  projectId: "portfoliox-2e787",
  appId: "1:562709786891:web:2d0f575ab7d3bda5fdf20e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* üîí VERY IMPORTANT ‚Äî REMEMBER LOGIN */
await setPersistence(auth, browserLocalPersistence);

/* UI Elements */
const verifyInfo = document.getElementById("verifyInfo");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const togglePassword = document.getElementById("toggleLoginPassword");

/* üëÅÔ∏è Show / Hide Password */
togglePassword.onclick = () => {
  passwordInput.type =
    passwordInput.type === "password" ? "text" : "password";
  togglePassword.textContent =
    passwordInput.type === "password" ? "üëÅÔ∏è" : "üôà";
};

/* üîÅ AUTO LOGIN (SESSION REMEMBER) */
onAuthStateChanged(auth, (user) => {
  if (user && user.emailVerified) {
    window.location.replace("dashboard.html");
  }
});

/* üìß EMAIL LOGIN */
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  try {
    const cred = await signInWithEmailAndPassword(
      auth,
      emailInput.value.trim(),
      passwordInput.value
    );

    if (!cred.user.emailVerified) {
      verifyInfo.style.display = "block";
      return;
    }

    window.location.replace("dashboard.html");

  } catch (err) {
    alert(err.message);
  }
});

/* üîÅ FORGOT PASSWORD */
document.getElementById("forgotPassword").onclick = async (e) => {
  e.preventDefault();

  if (!emailInput.value) {
    alert("Please enter your email first");
    return;
  }

  await sendPasswordResetEmail(auth, emailInput.value.trim());
  alert("üì© Password reset email sent.\nCheck Spam / Promotions.");
};

/* üîê GOOGLE LOGIN */
document.getElementById("googleLogin").onclick = async () => {
  try {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
    window.location.replace("dashboard.html");
  } catch (err) {
    alert(err.message);
  }
};
</script>

</body>
</html>
