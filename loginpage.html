<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | PortfolioX</title>
  <link rel="stylesheet" href="loginpage.css">
</head>
<body>

<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<div class="login-box">
  <h2>Login to <span>PortfolioX</span></h2>

  <!-- üîî Email verification info -->
  <div id="verifyInfo" style="
    display:none;
    margin-bottom:14px;
    padding:10px;
    border-radius:10px;
    background: rgba(255, 193, 7, 0.15);
    color:#facc15;
    font-size:13px;
    text-align:center;
  ">
    üìß Verification email may arrive in <b>Spam</b> or <b>Promotions</b>.<br>
    Please check <b>all folders</b>.
  </div>

  <form id="loginForm">

    <div class="field">
      <input type="email" id="email" required>
      <label>Email</label>
    </div>

    <!-- üîê Password with eye icon -->
    <div class="field" style="position:relative;">
      <input type="password" id="password" required>
      <label>Password</label>
      <span id="toggleLoginPassword" style="
        position:absolute;
        right:14px;
        top:50%;
        transform:translateY(-50%);
        cursor:pointer;
        user-select:none;
      ">üëÅÔ∏è</span>
    </div>

    <button class="primary glow" type="submit">Login</button>

    <!-- üîÅ Forgot Password -->
    <p style="text-align:center; margin-top:10px;">
      <a href="#" id="forgotPassword" style="color:#38bdf8;text-decoration:none;">
        Forgot password?
      </a>
    </p>

    <div style="margin:15px 0; text-align:center;">OR</div>

    <button type="button" id="googleLogin" class="primary glow">
      Continue with Google
    </button>

    <p class="signup-text">
      Don‚Äôt have an account?
      <a href="usersignup.html">Signup</a>
    </p>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    GoogleAuthProvider,
    signInWithPopup,
    sendPasswordResetEmail
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD4q_KzBCxVtS6mjH6Xh6-Bd1u-21RSNG4",
    authDomain: "portfoliox-2e787.firebaseapp.com",
    projectId: "portfoliox-2e787",
    storageBucket: "portfoliox-2e787.firebasestorage.app",
    messagingSenderId: "562709786891",
    appId: "1:562709786891:web:2d0f575ab7d3bda5fdf20e"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const verifyInfo = document.getElementById("verifyInfo");

  // üëÅÔ∏è Toggle password
  const passwordInput = document.getElementById("password");
  const toggleLoginPassword = document.getElementById("toggleLoginPassword");

  toggleLoginPassword.addEventListener("click", () => {
    passwordInput.type =
      passwordInput.type === "password" ? "text" : "password";
    toggleLoginPassword.textContent =
      passwordInput.type === "password" ? "üëÅÔ∏è" : "üôà";
  });

  // üìß Email Login
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = passwordInput.value;

    try {
      const cred = await signInWithEmailAndPassword(auth, email, password);

      if (!cred.user.emailVerified) {
        verifyInfo.style.display = "block";
        return;
      }

      window.location.href = "dashboard.html";
    } catch (err) {
      alert(err.message);
    }
  });

  // üîÅ Forgot Password
  document.getElementById("forgotPassword").addEventListener("click", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    if (!email) return alert("Please enter your email first");

    await sendPasswordResetEmail(auth, email);
    alert("üì© Password reset email sent.\nCheck Spam / Promotions.");
  });

  // üîê Google Login
  document.getElementById("googleLogin").addEventListener("click", async () => {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
    window.location.href = "dashboard.html";
  });
</script>

</body>
</html>
